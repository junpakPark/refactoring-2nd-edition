# Chapter10. 조건부 로직 간소화

---

> **조건부 로직** <br>
> 프로그램의 힘을 강화하는 데 크게 기여하지만, 프로그램을 복합하게 만드는 주요 원흉이기도 하다.


복잡한 조건문에 적용한다.

- 조건문 분해하기

논리적 조합을 명확하게 다듬는 데 적용한다.

- 중복 조건식 통합하기

함수의 핵심 로직에 본격적으로 들어가기 앞서 무언가를 검사해야할 때 적용한다.

- 중첩 조건문을 보호 구문으로 바꾸기

똑같은 분기 로직이 여러 곳에서 등장할 때 적용한다.

- 조건부 로직을 다형성으로 바꾸기

null과 같은 특이 케이스를 처리하는 데도 조건부 로직이 흔히 쓰인다.

- 특이 케이스 추가하기 (= 널 객체 추가하기)

프로그램의 상태를 확인하고 그 결과에 따라 다르게 동작해야하는 상황이면 적용한다.

- 어서션 추가하기

## 10.1 조건문 분해하기

### 복잡한 조건부 로직

- 프로그램을 복잡하게 만드는 가장 흔한 원흉
- 다양한 조건에 따라 동작도 다양한 코드를 작성하면 꽤 긴 함수가 탄생한다.
- 긴 함수는 그 자체로도 읽기가 어렵다.
- 조건문의 경우는 ‘왜’ 일어나는지 제대로 드러나지 않아서 읽기가 더 어렵다.

| 배경 | 기준:  조건문 분해가 적용되지 않은 조건식의 경우        |
|----|-------------------------------------|
| 절차 | 1. 조건식과 그 조건식에 딸린 조건절 각각을 함수로 추출한다. |
| 예시 | 1. 시즌별로 할인율이 달라지는 요금 계산             |

<br>

## 10.2 조건식 통합하기

### 조건부 코드를 통합해야하는 이유

- 여러 조각으로 나뉜 조건들을 하나로 통합함으로써 내가 하려는 일이 더 명확해진다
- 이 작업이 함수 추출하기까지 이어질 가능성이 높기 때문이다.

### 함수로 추출하는 이유 (6.1절)

- ‘무엇’을 하는지 기술하던 코드를 ‘왜’ 하는 지 말해주는 코드로 바꿔준다
- 코드의 의도가 훨씬 분명하게 드러난다

| 배경 | 기준: 비교하는 조건은 다르지만 그 결과로 수행하는 동작이 같은 경우                                                                                                                               |
|----|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 절차 | 1. 해당 조건식들 모두에 부수효과가 없는지 확인한다 <br> 2. 조건문 두 개를 선택하여 두 조건문의 조건식들을 논리 연산자로 결합한다. <br> 3. 테스트한다. <br> 4. 조건이 하나만 남을때까지 이전 과정을 반복한다. <br> 5.하나로 합쳐진 조건식을 함수로 추출할지 고려해본다. |
| 예시 | 1. or 사용하기  <br> 2. and 사용하기                                                                                                                                         |

<br>

## 10.3 중첩 조건문을 보호 구문으로 바꾸기

### 조건문의 두 형태

- 두 경로 모두 정상 동작인 경우 (if - then - else 구조)
- 한쪽만 정상인 경우 (보호 구문)

### 보호 구문(Guard Clauses)

- 한쪽만 정상이라면 비정상 조건을 if에서 검사한다.
- 조건이 참이면(= 비정상이면) 함수에서 빠져나온다.
- 보호 구문은 해당 함수의 핵심이 아니며, 이 일이 일어나면 무언가 조치를 취한 후 함수에서 빠져나나옴을 의미한다.

| 배경 | 기준: 조건문의 두 경로 중 하나의 경로만 정상인 경우 사용한다.                                                                                                   |
|----|----------------------------------------------------------------------------------------------------------------------------------------|
| 절차 | 1. 교체해야 할 조건 중 가장 바깥 것을 선택하여 보호 구문으로 바꾼다. <br> 2. 테스트한다. <br> 3. 이전 과정을 필요한 만큼 반복한다. <br> 4. 모든 보호 구문이 같은 결과를 반환한다면 보호 구문들의 조건식을 통합한다. |
| 예시 | 1. 직원 급여를 계산하는 코드 <br> 2. 조건 반대로 만들기                                                                                                   |

## 10.4 조건부 로직을 다형성으로 바꾸기

### 클래스와 다형성

- 복잡한 조건부 로직은 프로그램에서 해석하기 가장 난해한 대상에 속한다.
- 더 높은 수준의 개념을 도입해 해당 조건을 분리하면, 직관적으로 구조화할 수 있다.
- 예시
    - 타입을 여러 개 만들고 각 타입이 조건부 로직을 자신만의 방식으로 처리하도록 구성하는 방법
    - 기본 동작을 위한 case문과 그 변형 동작으로 구성된 로직

| 배경 | 기준: 같은 타입을 기준으로 분기하는 함수가 여러개인 경우 혹은 기본 동작과 변형 동작으로 구성된 함수인 경우 적용한다.                                                                                                                                                                                                                                                                                                                                                                                                       |
|----|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 절차 | 1. 다형적 동작을 표현하는 클래스들이 아직 없다면 만들어준다. 적합한 인스턴스를 알아서 만들어 반환하는 팩터리 함수도 함께 만든다. <br> 2. 호출하는 코드에서 팩터리 함수를 사용하게 한다. <br> 3. 조건부 로직 함수를 슈퍼 클래스로 옮긴다. 단, 조건부 로직이 온전한 함수로 분리되어 있지 않다면 먼저 함수로 추출한다. <br> 4. 서브 클래스 중 하나를 선택한다. 서브클래스에서 슈퍼클래스의 조건부 로직 메서드를 오버라이드한다. 조건부 문장 중 선택된 서브클래스에 해당하는 조건절을 서브클래스 메서드로 복사한 다음 적절히 수정한다. <br> 5. 같은 방식으로 각 조건절을 해당 서브클래스에서 메서드로 구현한다. <br> 6. 슈퍼클래스 메서드에는 기본 동작 부분만 남긴다. 혹은 슈퍼클래스가 추상 클래스여야 한다면, 이 메서드를 추상으로 선언하거나 서브클래스에서 처리해야 함을 알리는 에러를 던진다. |
| 예시 | 1. 새의 종에 따른 정보를 반환하는 코드 <br> 2. 변형동작을 다형성으로 표현하기                                                                                                                                                                                                                                                                                                                                                                                                                          |

<br>

## 10.5 특이 케이스 추가하기

### 특이 케이스 패턴

- 특수한 경우의 공통 동작을 요소 하나에 모아서 사용하는 것을 의미한다.
- 여러 곳에서 특정한 값에 대해 똑같이 반응하는 코드가 존재한다면 한 곳으로 모으는게 효율적이기 때문이다.
- 예시
    - 리터럴 객체: 단순히 데이터를 읽기만 하는 경우
    - 메서드를 담은 객체: 리터럴 객체 이상의 어떤 동작을 수행해야하는 경우
    - 널 객체 패턴

### 컨테이너

- 리팩터링의 대상이 될 속성을 담은 데이터 구조(혹은 클래스)를 의미한다.
- 해당 속성이 특이한 값인지 검사한다.
- 특별하게 다뤄야할 값인 경우, 특이 케이스 클래스 (혹은 데이터 구조)로 대체한다.

| 배경 | 기준: 특수한 경우에 공통 동작을 해야하는 경우, 한 요소에 모아서 사용한다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|----|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 절차 | 1. 컨테이너에 특이 케이스인지 검사하는 속성을 추가하고, false를 반환하게 한다.<br> 2. 특이 케이스 객체를 만든다. 이 객체에 특이 케이스인지를 검사하는 속성만 포함하고, true를 반환하게 한다.<br> 3. 클라이언트에서 특이 케이스인지를 검사하는 코드를 함수로 추출한다. 모든 클라이언트가 값을 직접 비교하는 대신 방금 추출한 함수를 사용하도록 고친다.<br> 4. 코드에 새로운 특이 케이스 대상을 추가한다. 함수의 반환 값으로 받거나 변환 함수를 적용하면 된다.<br> 5. 특이 케이스를 검사하는 함수 본문을 수정하여 특이 케이스 객체의 속성을 사용하도록 한다.<br> 6. 테스트 한다.<br> 7. 여러 함수를 클래스로 묶기나 여러 함수를 변환 함수로 묶기를 적용하여 특이 케이스를 처리하는 공통 동작을 새로운 요소로 옮긴다. 특이 케이스 클래스는 간단한 요청에는 항상 같은 값을 반환하는 게 보통이므로, 해당 특이 케이스의 리터럴 레코드를 활용할 수 있을 것이다.<br> 8. 아직도 특이 케이스 검사 함수를 이용하는 곳이 남아 있다면 검사 함수를 인라인한다. |
| 예시 | 1. 미확인 고객을 처리하는 코드 <br> 2. 객체 리터럴 이용하기 <br> 3. 변환 함수 이용하기                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

<br>

## 10.6 어서션 추가하기

### 어서션

- 항상 참이라 가정하는 조건부 문장
- 시스템의 다른 부분에서 절대 검사하지 않는다.
- 어서션의 유무가 프로그램 기능의 정상 동작에 아무런 영향을 주지 않도록 작성돼야한다.
- 오류 찾기에 활용할 수 있다.
- 프로그램이 어떤 상태임을 가정한 채 실행되는지를 다른 개발자에게 알려준다.
- 실패
    - 프로그래머의 잘못으로 발생한다.

### 테스트와 어서션

- 테스트 코드가 있다면 어서션의 디버깅 용도로서의 효용은 줄어든다.
- 단위 테스트를 꾸준히 추가하여 사각을 좁히면 어서션보다 나을때가 많다
- 그러나 소통 측면에서는 어서션이 더 매력적이다.

| 배경 | 기준: 참이라고 가정하는 조건이 보이는 경우                       |
|----|------------------------------------------------|
| 절차 | 1. 참이라고 가정하는 조건이 보이는 경우, 그 조건을 명시하는 어서션을 추가한다. |
| 예시 | 1. 할인과 관련한 코드                                  |

<br>

## 10.7 제어 플래그를 탈출문으로 바꾸기

### 제어 플래그

- 코드의 동작을 변경하는 데 사용되는 변수
- 제어플래그에 어딘가에서 계산한 값을 설정한 후, 다른 어딘가의 조건문에서 검사하는 형태로 쓰인다.
- 주로 반복문에 위치한다.

| 배경 | 기준: break 문이나 continue 문, return문을 적절하게 이용하지 못하는 경우                                                                                                       |
|----|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| 절차 | 1. 제어 플래그를 사용하는 코드를 함수로 추출할지 고려한다.<br> 2. 제어 플래그를 갱신하는 코드 각각을 적절한 제어문(주로 return, break, continue)으로 바꾼다. 하나씩 바꿀 때마다 테스트한다.ㅈ<br> 3. 모두 수정했다면 제어 플래그를 제거한다. |
| 예시 | 1. 목록에서 특정한 값을 찾는 코드                                                                                                                                      |
