# Chapter1. 리팩터링: 첫 번째 예시

***

## 0단계: 요구 사항 분석 및 코드 작성

### 기능 요구 사항 (공연료 청구서 출력)

- 공연 요청이 들어오면 연극의 장르와 관객 규모를 기초로 비용을 책정한다.
- 현재 이 극단은 두 가지 장르, 비극(tragedy) 와 희극(comedy) 만 공연한다.
- 그리고 공연료와 별개로 포인트(volume credit) 를 지급해서 다음번 의뢰 시 공연료를 할인받을 수 있다.
- 극단은 공연할 연극 정보를 `plays.json`과 같은 형태로 저장한다.
- 극단은 공연료 청구서에 들어갈 데이터를 `invoice.json`과 같은 형태로 저장한다.
- 결과는 다음과 같이 출력된다.

  ```text
    청구 내역 (고객명: BigCo)
     Hamlet: $650.00원 (55석)
     As You Like It: $580.00원 (35석)
     Othello: $500.00원 (40석)
    총액: $1,730.00원
    적립 포인트: 47점
  ```

### 프로그래밍 요구 사항

자바스크립트와 자바간의 패러다임 차이를 해결하기 위해 다음 사항을 추가한 상태로 시작한다.

1. 코드를 실행하기 위한 `application` 클래스 추가
2. 기존 `statement()`를 `Statement` 클래스에 static 메서드로 선언
3. json 파일을 로드해 자바 객체로 변환하기 위한 `loadResource()` 메서드 구현
    - json 데이터를 저장할 `record` 추가한다
    - 클래스 로더를 통해 `resourcePath`로 지정된 json 파일을 **InputStream** 형태로 가져온다.
    - **InputStream**으로부터 읽은 JSON 데이터를, `Jackson` 라이브러리를 통해 `typeRef`에서 명시한 타입(`T`)으로 변환한다.

### 만약  청구 내역을 HTML로 출력하는 기능이 추가되어야 한다면?

> 프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 
> 먼저 기능을 추가하기 쉬운 형태로 리팩토링하고 나서 원하는 기능을 추가한다.
