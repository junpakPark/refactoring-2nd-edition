# Chapter2. 리팩터링 원칙

***

## 리팩터링 정의

> 누군가 "리팩터링하다 코드가 깨져서 며칠이나 고생했다"라고 한다면, <br> 십중팔구 리팩터링 한 것이 아니다.

| 구분                 | 설명                          |
|--------------------|-----------------------------|
| 재구성(Restructuring) | 코드 베이스를 정리하거나 구조를 바꾸는 모둔 작업 |
| 리팩터링(Refactoring)  | 재구성 중 특정한 방식에 따라 코드를 정리하는 것 |

### 리팩터링의 의미

| 구분 | 설명                               |
|----|----------------------------------|
| 공통 | 소프트웨어의 겉보기 동작은 그대로 유지한 채,        |
| 명사 | 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법 |
| 동사 | 여러가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다. |

### 리팩터링의 핵심요소

1. 동작을 보존하는 작은 단계들을 거쳐서 코드 수정
2. 이러한 단계를 순차적으로 연결하여 큰 변화를 만들어냄
3. 리팩터링 중에도 코드가 정상 작동하므로 언제든지 중단 가능

### 리팩터링과 성능 최적화

공통점: 둘 다 코드를 변경하며 프로그램의 전반적인 기능은 그대로 유지한다.

|    | 리팩터링                     | 성능최적화                   |
|----|--------------------------|-------------------------|
| 목적 | 코드를 이해하고 수정하기 쉽게 만드는 것   | 오로지 속도 개선               |
| 결과 | 프로그램의 성능이 나빠지거나 좋아질 수 있음 | 코드를 다루기에 더 어렵게 수정할 수 있음 |

## 두개의 모자

|     | 기능 추가                            | 리팩터링                                            |
|-----|----------------------------------|-------------------------------------------------|
| 행위  | 기존 코드를 절대 건드리지 않고 새 기능을 추가하기만 한다 | 기능 추가는 절대로 하지 않고 오로지 코드 재구성에만 전념한다              |
| 테스트 | 테스트를 적극적으로 만든다                   | 테스트도 만들지 않는다 <br> 인터페이스를 변경해야 할 때만 기존 테스트를 수정한다 |

> 작업시간이 짧더라도, 내가 쓰고 있는 모자가 무엇인지와 <br>
> 그에 따른 미묘한 작업방식을 분명하게 인식해야한다.

## 리팩터링 하는 이유

- 리팩터링하면 소프트웨어 설계가 좋아진다.
- 리팩터링하면 소프트웨어를 이해하기 쉬워진다.
- 리팩터링하면 버그를 쉽게 찾을 수 있다.
- 리팩터링하면 프로그래밍 속도를 높일 수 있다.

## 언제 리팩터링해야 할까?

### 3의 법칙 (존 로버츠 가이드)

> 1. 처음에는 그냥 한다. <br>
> 2. 비슷한 일을 두 번째로 하게 되면(중복이 생겼더라도) 일단 계속 진행한다. <br>
> 3. 비슷한 일을 세 번째 하게 되면 리팩터링 한다. <br>

1. 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기
2. 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기
3. 쓰레기 줍기 리팩터링
4. 계획된 리팩터링과 수시로 하는 리팩터링
5. 오래 걸리는 리팩터링
6. 코드 리뷰에 리팩터링 활용하기

### 리팩터링을 하지 말아야할 때

| 상황                     | 리팩터링 여부                                    |
|------------------------|--------------------------------------------|
| 외부 API처럼 호출해서 사용하는 코드	 | 내부 동작을 이해해야 할 시점이 올 때까지 유지                 |
| 처음부터 다시 만드는 것이 더 나은 경우 | 신중한 판단이 필요, 경험이 부족하다면 직접 리팩터링을 시도해보는 것도 방법 |

## 리팩터링 시 고려할 문제

### 새 기능 개발 속도 저하

> 리팩터링의 궁극적인 목적은 개발 속도를 높여서, <br> 더 적은 노력으로 더 많은 가치를 창출하는 것이다.

### 코드 소유권

### 브랜치

### 테스팅

### 레거시 코드

### 데이터베이스

## 더 알고 싶다면

- [리팩터링 워크북 (인사이트, 2006)](https://product.kyobobook.co.kr/detail/S000001469794) - 절판
- [패턴을 활용한 리팩터링 (인사이트, 2011)](https://product.kyobobook.co.kr/detail/S000001469867)
- [리팩토링 데이터베이스(위키북스, 2007)](https://product.kyobobook.co.kr/detail/S000001583217) - 절판
- [리팩토링 HTML(에이콘출판사, 2009)](https://product.kyobobook.co.kr/detail/S000000935136) - 절판
- [레거시 코드 활용 전략 (에이콘출판사, 2018)](https://product.kyobobook.co.kr/detail/S000001804724)
